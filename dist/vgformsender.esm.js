// @vegas-VGFormSender v3.0.0
function t(...e){const s=t=>t&&"object"==typeof t;return e.reduce(((e,i)=>(Object.keys(i).forEach((n=>{const r=e[n],o=i[n];Array.isArray(r)&&Array.isArray(o)?e[n]=r.concat(...o):s(r)&&s(o)?e[n]=t(r,o):e[n]=o})),e)),{})}const e={};function s(t){if(t.getAttribute("data-max-height"))"0"===t.style.maxHeight.replace("px","").replace("%","")?t.style.maxHeight=t.getAttribute("data-max-height"):t.style.maxHeight="0";else{let e=function(t){let e=window.getComputedStyle(t),s=e.display,i=e.position,n=e.visibility,r=e.maxHeight.replace("px","").replace("%",""),o=0;return"none"!==s&&"0"!==r?t.offsetHeight:(t.style.position="absolute",t.style.visibility="hidden",t.style.display="block",o=t.offsetHeight,t.style.display=s,t.style.position=i,t.style.visibility=n,o)}(t)+"px"||"0";t.style.transition="max-height 0.5s ease-in-out",t.style.overflowY="hidden",t.style.maxHeight="0",t.setAttribute("data-max-height",e),t.style.display="block",setTimeout((function(){t.style.maxHeight=e}),10)}}e.x=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;let t,e=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];for(let s=0;s<e.length;s++)try{t=new ActiveXObject(e[s]);break}catch(t){}return t},e.send=function(t,s,i,n,r){void 0===r&&(r=!0);let o=e.x();o.open(i,t,r),o.onreadystatechange=function(){4===o.readyState&&s(o.responseText)},"POST"===i&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(n)},e.get=function(t,s,i,n){let r=[];for(let t in s)r.push(encodeURIComponent(t)+"="+encodeURIComponent(s[t]));e.send(t+(r.length?"?"+r.join("&"):""),i,"GET",null,n)},e.post=function(t,s,i,n){let r=[];for(let t in s)r.push(encodeURIComponent(t)+"="+encodeURIComponent(s[t]));e.send(t,i,"POST",r.join("&"),n)};class i extends class{constructor(e,s={}){if(this.form=e,this.settings=s,!e)return console.error("Первый параметр не должен быть пустым"),!1;{let i={action:e.getAttribute("action")||location.href,method:e.getAttribute("method")||"get",fields:null,jsonParse:"false"!==e.getAttribute("data-json-parse"),redirect:e.getAttribute("data-redirect")||!1,validate:e.getAttribute("data-validate")||!1,alert:"false"!==e.getAttribute("data-alert"),alertParams:{type:e.getAttribute("data-alert-type")||"modal"}};this.isInit=!1,this.form=e,this.settings=t(i,s),this.classes={general:"vg-form-sender",selector:"vg-form-sender__selector"},this.settings.fields&&"function"==typeof this.settings.fields&&(this.settings.fields=this.settings.fields()),this.init()}}init(){const t=this;t.form.classList.add(t.classes.general);let e=t.form.querySelectorAll("input, textarea");if(e.length)for(const s of e)s.parentElement.classList.add(t.classes.selector);t.settings.validate&&(t.form.setAttribute("novalidate",""),t.form.classList.add("needs-validation")),t.isInit=!0}submit(t){if(!this.isInit)return!1;const e=this;e.form.onsubmit=function(s){let i=new FormData(this);return"object"==typeof e.settings.fields&&(e.data=function(t,e){for(let s in e)if("object"==typeof e[s])for(let i in e[s]){let n=Object.keys(e[s][i]).map((function(t){return e[s][i][t]}));t.append(s,n)}else t.append(s,e[s]);return t}(i,e.settings.fields)),e.settings.validate&&!e.form.checkValidity()?(s.preventDefault(),s.stopPropagation(),e.form.classList.add("was-validated"),!1):e.request(t)}}request(t){if(!this.isInit)return!1;const s=this;let i=s.settings.method.toLowerCase(),n=s.settings.action,r=s.data;return t&&"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(s.form),"post"===i&&e.post(n,r,(function(e){s.form.classList.remove("was-validated"),t&&"success"in t&&"function"==typeof t.success&&t.success(s.form,e)})),"get"===i&&e.get(n,r,(function(e){s.form.classList.remove("was-validated"),t&&"success"in t&&"function"==typeof t.success&&t.success(s.form,e)})),!1}}{constructor(e,s={}){super(e,s),this.isAlert=this.settings.alert;this.classes=t(this.classes,{alert:{block:"vg-form-sender--alert-block",modal:"vg-form-sender--alert-modal"}})}submit(t){if(this.isAlert){const e=this;return super.submit({beforeSend:function(s){e.btnSubmit(s,"before"),e.alert(s,{},"before"),t&&"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(s)},success:function(s,i){e.settings.jsonParse&&"string"==typeof i&&(i=JSON.parse(i)),e.btnSubmit(s,"success"),e.alert(s,i,"success"),t&&"success"in t&&"function"==typeof t.success&&t.success(s,i)}})}return super.submit(t)}alert(t,e,s){if(!this.isAlert)return!1;const i=this;"block"===i.settings.alertParams.type&&i.alertBlock(t,e,s),"modal"===i.settings.alertParams.type&&"success"===s&&i.alertModal(t,e,s)}btnSubmit(t,e){if(!this.isAlert)return!1;let s=t.querySelector('[type="submit"]');if(s||(s=document.querySelector('[form="'+t.id+'"]')),s){let t={send:s.getAttribute("data-text-send")||"Отправляем...",text:s.getAttribute("data-text")||"Отправить"};"before"===e?s.innerHTML=t.send:"success"===e&&(s.innerHTML=t.text)}}alertBlock(t,e,i){const n=this;let r=t.querySelector("."+n.classes.alert.block);if(!r){let o=document.querySelector('[data-form="'+t.id+'"]');if(o)r=o;else{let a=document.createElement("div");a.classList.add(n.classes.alert.block),a.innerHTML='<div class="alert alert-danger"></div><div class="alert alert-success"></div>',t.prepend(a),r=a}}if("before"===i)r.classList.contains("active")&&(s(r),r.classList.remove("active"));else if("success"===i){r.classList.add("active");let l=r.querySelectorAll(".show");if(l.length)for(const d of l)d.classList.remove("show");function c(t,s){let i=t.querySelector(".alert-"+s);if(i){let t=i.querySelector("[data-alert-text-"+s+"]");if(t){let i=t.getAttribute("data-alert-text-"+s);i?t.innerHTML=i:"msg"in e&&(t.innerHTML=e.msg)}else"msg"in e&&(i.innerHTML=e.msg);i.classList.add("show")}else t.innerHTML=e.msg}e&&"errors"in e&&(e.errors?c(r,"danger"):c(r,"success")),s(r)}}alertModal(t,e,s){const i=this;let n=document.querySelector("."+i.classes.alert.modal);if(!n){let t=document.createElement("div");t.classList.add("modal"),t.classList.add("fade"),t.classList.add(i.classes.alert.modal),t.setAttribute("id",i.classes.alert.modal),t.innerHTML='<div class="modal-dialog" role="document">        <div class="modal-content"></div>    </div>',document.body.append(t),n=t}}}export{i as VGFormSender};
