// @vegas-VGFormSender v3.0.1
import{Modal as t}from"bootstrap";function e(...t){const s=t=>t&&"object"==typeof t;return t.reduce(((t,a)=>(Object.keys(a).forEach((l=>{const i=t[l],r=a[l];Array.isArray(i)&&Array.isArray(r)?t[l]=i.concat(...r):s(i)&&s(r)?t[l]=e(i,r):t[l]=r})),t)),{})}const s={x:function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;let t,e=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];for(let s=0;s<e.length;s++)try{t=new ActiveXObject(e[s]);break}catch(t){}return t},send:function(t,e,a,l,i){void 0===i&&(i=!0);let r=s.x();r.open(a,t,i),r.onreadystatechange=function(){4===r.readyState&&e(r.responseText)},"POST"===a&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(l)},get:function(t,e,a,l){let i=[];for(let t of e)i.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1]));s.send(t+(i.length?"?"+i.join("&"):""),a,"GET",null,l)},post:function(t,e,a,l){s.send(t,a,"POST",e,l)}},a=function(t,e){const s=new CustomEvent(e,{bubbles:!0});t.dispatchEvent(s)},l="vg.fs.success",i={action:location.href,method:"post",fields:[],jsonParse:!0,redirect:null,validate:!1,alert:!0,alertParams:{type:"modal"}};class r{constructor(t,s={}){if(this.form=t,this.extElement={},!t)return console.error("Первый параметр не должен быть пустым"),!1;this.isInit=!1,this.form=t,this.settings=function(t,s,a){let l=e(s,a),i=[].filter.call(t.attributes,(function(t){return/^data-/.test(t.name)}));for(let t of i)"data-alert-type"===t.name&&t.value&&(l.alertParams.type=t.value),"data-alert"===t.name&&(l.alert="false"!==t.value),"data-validate"===t.name&&(l.validate="false"!==t.value),"data-json-parse"===t.name&&(l.jsonParse="false"!==t.value),"data-redirect"===t.name&&t.value&&(l.redirect=t.value);return l.action=t.getAttribute("action")||l.action,l.method=t.getAttribute("method")||l.method,l}(t,i,s),this.classes={general:"vg-form-sender"},this.settings.fields&&"function"==typeof this.settings.fields&&(this.settings.fields=this.settings.fields()),this.init()}init(){const e=this;e.form.classList.add(e.classes.general),e.settings.validate&&(e.form.setAttribute("novalidate",""),e.form.classList.add("needs-validation"));let s=e.form.closest(".modal");s&&(e.extElement.modal=new t(s));let a=e.form.querySelector('[type="submit"]');a||(a=document.querySelector('[form="'+e.form.id+'"]')),e.extElement.button=a,e.isInit=!0}submit(t){if(!this.isInit)return!1;const e=this;e.form.onsubmit=function(s){let a=new FormData(e.form);return"object"==typeof e.settings.fields&&(e.data=function(t,e){for(let s in e)if("object"==typeof e[s])for(let a in e[s]){let l=Object.keys(e[s][a]).map((function(t){return e[s][a][t]}));t.append(s,l)}else t.append(s,e[s]);return t}(a,e.settings.fields)),e.settings.validate&&!e.form.checkValidity()?(s.preventDefault(),s.stopPropagation(),e.form.classList.add("was-validated"),!1):e.request(t,s)}}request(t,e){if(!this.isInit)return!1;const i=this;let r=i.settings.method.toLowerCase(),n=i.settings.action,o=i.data;function c(){i.settings.redirect&&(window.location.href=i.settings.redirect)}return t&&"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(e,i),a(i.form,"vg.fs.before"),"post"===r&&s.post(n,o,(function(s){i.form.classList.remove("was-validated"),t&&"success"in t&&"function"==typeof t.success&&t.success(e,i,s),a(i.form,l),c()})),"get"===r&&s.get(n,o,(function(s){i.form.classList.remove("was-validated"),t&&"success"in t&&"function"==typeof t.success&&t.success(e,i,s),a(i.form,l),c()})),!1}}function n(t){if(t.getAttribute("data-max-height"))"0"===t.style.maxHeight.replace("px","").replace("%","")?t.style.maxHeight=t.getAttribute("data-max-height"):t.style.maxHeight="0";else{let e=function(t){let e=window.getComputedStyle(t),s=e.display,a=e.position,l=e.visibility,i=e.maxHeight.replace("px","").replace("%",""),r=0;return"none"!==s&&"0"!==i?t.offsetHeight:(t.style.position="absolute",t.style.visibility="hidden",t.style.display="block",r=t.offsetHeight,t.style.display=s,t.style.position=a,t.style.visibility=l,r)}(t)+"px"||"0";t.style.transition="max-height 0.5s ease-in-out",t.style.overflowY="hidden",t.style.maxHeight="0",t.setAttribute("data-max-height",e),t.style.display="block",setTimeout((function(){t.style.maxHeight=e}),10)}}class o extends r{constructor(t,s={}){super(t,s),this.isAlert=this.settings.alert;return this.classes=e(this.classes,{alert:{block:"vg-form-sender--alert-block",modal:"vg-form-sender--alert-modal"}}),this.alertElement=null,this.svg={error:'<svg viewbox="0 0 500 500" class="am_Error_Icon"><path class="am_SVG_circle" d="m444.34693,114.07007a236.95276,236.95276 0 0 1 44.1553,137.73747c0,129.97005 -106.94772,236.96443 -236.91777,236.96443s-236.91777,-106.94772 -236.91777,-236.91777s106.94772,-236.96443 236.91777,-236.96443a236.99941,236.99941 0 0 1 168.72548,70.59483"></path><line class="am_SVG_error1" y2="390" x2="390" y1="110" x1="110"></line><line class="am_SVG_error2" y2="390" x2="110" y1="110" x1="390"></line></svg>',success:'<svg viewbox="0 0 500 500" class="am_Success_Icon"><path class="am_SVG_circle" d="m443.0136,114.07007a236.95276,236.95276 0 0 1 44.1553,137.73747c0,129.97005 -106.94772,236.96443 -236.91777,236.96443s-236.91777,-106.94772 -236.91777,-236.91777s106.94772,-236.96443 236.91777,-236.96443a236.99941,236.99941 0 0 1 168.72548,70.59483"></path><polyline class="am_SVG_check" points="104.4892349243164,309.2001647949219 195.57406616210938,402.9600524902344 418.9292297363281,85.03718566894531 "></polyline></svg>',cross:'<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 224.512 224.512" style="enable-background:new 0 0 224.512 224.512;" xml:space="preserve"><g><polygon style="fill:#010002;" points="224.507,6.997 217.521,0 112.256,105.258 6.998,0 0.005,6.997 105.263,112.254 0.005,217.512 6.998,224.512 112.256,119.24 217.521,224.512 224.507,217.512 119.249,112.254 "/></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>'},"block"===this.settings.alertParams.type&&(this.alertElement=this._drawAlertBlock(t)),"modal"===this.settings.alertParams.type&&(this.alertElement=this._drawAlertModal()),this}submit(t){if(this.isAlert){const e=this;return super.submit({beforeSend:function(s,a){t&&"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(s,a),e.btnSubmit(a,"before"),e.alert(a,{},"before")},success:function(s,a,l){t&&"success"in t&&"function"==typeof t.success&&t.success(s,a,l),e.settings.jsonParse&&"string"==typeof l&&(l=JSON.parse(l)),e.btnSubmit(a,"success"),e.alert(a,l,"success")}})}return super.submit(t)}alert(t,e,s){if(!this.isAlert)return!1;const a=this;t.alertElement=a.alertElement,"block"===a.settings.alertParams.type&&a.alertBlock(t,e,s),"modal"===a.settings.alertParams.type&&"success"===s&&a.alertModal(t,e)}btnSubmit(t,e){if(!this.isAlert)return!1;let s=t.extElement.button;if(s){let t=s.getAttribute("data-text")?s:s.querySelector("[data-text]"),a={send:t.getAttribute("data-text-send")||"Отправляем...",text:t.getAttribute("data-text")||"Отправить"};"before"===e?t.innerHTML=a.send:"success"===e&&(t.innerHTML=a.text)}}alertBlock(t,e,s){let a=t.alertElement;if("before"===s)a.classList.contains("active")&&(n(a),a.classList.remove("active"));else if("success"===s){a.classList.add("active");let l=a.querySelectorAll(".show");if(l.length)for(const o of l)o.classList.remove("show");function i(t,s){let a=t.querySelector(".vg-alert-"+s);if(a){let t=a.querySelector("[data-alert-"+s+"-text]");t&&"msg"in e&&(t.innerHTML=e.msg);let l=a.querySelector("[data-alert-"+s+"-title]");l&&"title"in e&&(l.innerHTML=e.title),a.classList.add("show")}else t.innerHTML=e.msg}e&&"errors"in e&&(e.errors?i(a,"danger"):i(a,"success")),n(a);let r=a.querySelector('[data-dismiss="alert-block"]');r&&(r.onclick=function(){return n(a),a.classList.remove("active"),!1})}}alertModal(e,s){let a=e.alertElement,l=a.querySelectorAll(".show");if(l.length)for(const t of l)t.classList.remove("show");function i(t,e){let a=t.querySelector(".vg-alert-content");if(a){let t=a.querySelector(".vg-alert-"+e);if(t){let a=t.querySelector("[data-alert-"+e+"-title]");a&&"msg"in s&&(a.innerHTML=s.title);let l=t.querySelector("[data-alert-"+e+"-text]");l&&"msg"in s&&(l.innerHTML=s.msg),t.classList.add("show")}else t.innerHTML=s.msg}else t.innerHTML=s.msg}s&&"errors"in s&&(s.errors?i(a,"danger"):i(a,"success")),e.extElement.modal&&e.extElement.modal.hide();new t("#"+this.classes.alert.modal,{}).show()}_drawAlertBlock(t){const e=this;let s=t.querySelector("."+e.classes.alert.block);if(!s){let a=document.querySelector('[data-form="'+t.id+'"]');if(a)s=a;else{let a=document.createElement("div");a.classList.add(e.classes.alert.block),a.innerHTML='<div class="close"><a href="#" data-dismiss="alert-block">'+e.svg.cross+'</a></div><div class="vg-alert vg-alert-danger">\t\t\t\t\t<div class="svg-area">'+e.svg.error+'</div>\t\t\t\t\t<div class="content-area">\t\t\t\t\t\t<div class="title-area" data-alert-danger-title></div>\t\t\t\t\t\t<div class="text-area" data-alert-danger-text></div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="vg-alert vg-alert-success">\t\t\t\t\t<div class="svg-area">'+e.svg.success+'</div>\t\t\t\t\t<div class="content-area">\t\t\t\t\t\t<div class="title-area" data-alert-success-title></div>\t\t\t\t\t\t<div class="text-area" data-alert-success-text></div>\t\t\t\t\t</div>\t\t\t\t</div>',t.prepend(a),s=a}}return s}_drawAlertModal(){const t=this;let e=document.querySelector("."+t.classes.alert.modal);if(e)return e;{let e=document.createElement("div");return e.classList.add("modal"),e.classList.add("fade"),e.classList.add(t.classes.alert.modal),e.setAttribute("id",t.classes.alert.modal),e.innerHTML='<div class="modal-dialog" role="document">        <div class="modal-content">            <button type="button" class="modal-close" data-bs-dismiss="modal" aria-label="Close">'+t.svg.cross+'</button>            <div class="vg-alert-content">                <div class="vg-alert vg-alert-danger">                     <div class="svg-area">'+t.svg.error+'</div>                     <div class="title-area" data-alert-danger-title></div>                     <div class="text-area" data-alert-danger-text></div>                </div>                <div class="vg-alert vg-alert-success">                     <div class="svg-area">'+t.svg.success+'</div>                     <div class="title-area" data-alert-success-title></div>                     <div class="text-area" data-alert-success-text></div>                </div>            </div>        </div>    </div>',document.body.append(e),e}}}export{o as VGFormSender};
